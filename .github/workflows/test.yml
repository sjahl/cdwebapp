name: Unit Tests

on:
  push:
    branches:
      - main
    paths-ignore:
      - '.github/**'
  pull_request:
    types: [opened, synchronize, reopened]
    paths-ignore:
      - '.github/**'

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        go: [ '1.17', '1.18' ]
    name: Go ${{ matrix.go }} test
    steps:
      - uses: actions/checkout@v2
      - name: Setup go
        uses: actions/setup-go@v1
        with:
          go-version: ${{ matrix.go }}
      - run: go test
  # bump_image_in_helm:
  #   runs-on: ubuntu-latest
  #   name: update version spec in helm chart
  #   needs: docker_release
  #   steps:
  #     - name: Repository Dispatch
  #       uses: peter-evans/repository-dispatch@v1
  #       with:
  #         token: ${{ secrets.CI_AUTOMATION_TOKEN }}
  #         repository: sjahl/helm-cdwebapp
  #         event-type: update-chart
  #         client-payload: '{"ref": "${{ github.ref }}", "sha8": "${{ needs.docker_release.outputs.imageTag }}", "target_file": "./charts/cdwebappvalues.yaml"}'
